<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calculadora de Distratos - V4 Company</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
    .result-card {
        transition: all 0.3s ease-in-out;
    }
  </style>
</head>

<body class="bg-gray-100 flex items-center justify-center min-h-screen">

  <div class="container bg-white shadow-2xl rounded-2xl p-8 max-w-2xl w-full m-4">
    <h1 class="text-3xl font-bold text-center text-gray-800 mb-8">Calculadora de Distratos V4</h1>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
        <div>
            <label for="numVigencias" class="block text-sm font-medium text-gray-700 mb-1">Vigências do contrato (meses):</label>
            <input type="number" id="numVigencias" min="1" placeholder="Ex: 12" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500">
        </div>
        <div>
            <label for="fee" class="block text-sm font-medium text-gray-700 mb-1">Valor do Fee (R$):</label>
            <input type="number" id="fee" placeholder="Ex: 1500" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500">
        </div>
        <div>
            <label for="dataInicial" class="block text-sm font-medium text-gray-700 mb-1">Data de início do contrato:</label>
            <input type="date" id="dataInicial" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500">
        </div>
        <div>
            <label for="ultimoDia" class="block text-sm font-medium text-gray-700 mb-1">Último dia de serviço:</label>
            <input type="date" id="ultimoDia" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500">
        </div>
        <div>
            <label for="feesPagos" class="block text-sm font-medium text-gray-700 mb-1">Quantos fees foram pagos?</label>
            <input type="number" id="feesPagos" min="0" placeholder="Ex: 5" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500">
        </div>
        <div>
            <label for="avisoPrevio" class="block text-sm font-medium text-gray-700 mb-1">Aviso prévio:</label>
            <select id="avisoPrevio" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500">
              <option value="0">Sem aviso prévio</option>
              <option value="30">Aviso prévio de 30 dias</option>
              <option value="60">Aviso prévio de 60 dias</option>
            </select>
        </div>
    </div>

    <button onclick="calcularDistrato()" class="w-full bg-red-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-red-700 transition duration-300 text-lg">Calcular</button>

    <div id="resultado" class="mt-8"></div>
    <div id="vigenciasResultado" class="mt-6"></div>
  </div>

<script>
    // Função para formatar datas no padrão brasileiro (DD/MM/AAAA)
    function formatarData(data) {
        // Adiciona 1 dia para corrigir problemas de fuso horário na exibição
        const dataCorrigida = new Date(data.getTime() + (data.getTimezoneOffset() * 60000) + 86400000);
        return dataCorrigida.toLocaleDateString('pt-BR', { timeZone: 'UTC' });
    }

    // Função para formatar valores monetários
    function formatarMoeda(valor) {
        return valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
    }

    // Função principal que realiza o cálculo do distrato
    function calcularDistrato() {
        // Coleta dos valores dos campos de entrada
        const numVigencias = parseInt(document.getElementById('numVigencias').value);
        const dataInicialStr = document.getElementById('dataInicial').value;
        const fee = parseFloat(document.getElementById('fee').value);
        const ultimoDiaStr = document.getElementById('ultimoDia').value;
        const feesPagos = parseInt(document.getElementById('feesPagos').value);
        const avisoPrevioDias = parseInt(document.getElementById('avisoPrevio').value);

        const resultadoDiv = document.getElementById('resultado');
        const vigenciasDiv = document.getElementById('vigenciasResultado');
        
        // Limpa resultados anteriores
        resultadoDiv.innerHTML = '';
        vigenciasDiv.innerHTML = '';

        // Validação dos campos de entrada
        if (!numVigencias || !dataInicialStr || !fee || !ultimoDiaStr || isNaN(feesPagos)) {
            resultadoDiv.innerHTML = `<div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-lg result-card" role="alert"><p class="font-bold">Erro!</p><p>Por favor, preencha todos os campos para continuar.</p></div>`;
            return;
        }
        
        // Converte as strings de data para objetos Date em UTC para evitar problemas de fuso horário
        const dataInicial = new Date(dataInicialStr + 'T00:00:00');
        const ultimoDia = new Date(ultimoDiaStr + 'T00:00:00');

        // Geração das vigências do contrato
        let vigencias = [];
        for (let i = 0; i < numVigencias; i++) {
            let inicioVigencia = new Date(dataInicial);
            inicioVigencia.setUTCMonth(dataInicial.getUTCMonth() + i);

            let fimVigencia = new Date(dataInicial);
            fimVigencia.setUTCMonth(dataInicial.getUTCMonth() + i + 1);
            fimVigencia.setUTCDate(fimVigencia.getUTCDate() - 1);
            
            vigencias.push({ inicio: inicioVigencia, fim: fimVigencia });
        }

        // Encontra a vigência em que o último dia de serviço se encontra
        let vigenciaAtualIndex = vigencias.findIndex(v => ultimoDia >= v.inicio && ultimoDia <= v.fim);
        if (vigenciaAtualIndex === -1) {
             resultadoDiv.innerHTML = `<div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-lg result-card" role="alert"><p class="font-bold">Erro!</p><p>O último dia de serviço está fora do período do contrato.</p></div>`;
            return;
        }
        const vigenciaAtual = vigencias[vigenciaAtualIndex];

        // Cálculo do valor proporcional
        const diasNoMes = (vigenciaAtual.fim.getTime() - vigenciaAtual.inicio.getTime()) / (1000 * 3600 * 24) + 1;
        const diasTrabalhados = (ultimoDia.getTime() - vigenciaAtual.inicio.getTime()) / (1000 * 3600 * 24) + 1;
        const valorProporcional = (fee / diasNoMes) * diasTrabalhados;
        
        // Cálculo dos fees em atraso
        const feesDevidos = vigenciaAtualIndex; // Fees completos antes do mês do cancelamento
        const feesEmAtraso = Math.max(0, feesDevidos - feesPagos);
        const valorFeesEmAtraso = feesEmAtraso * fee;

        // Cálculo da multa rescisória (10% sobre o valor restante)
        const mesesRestantes = numVigencias - (vigenciaAtualIndex + 1);
        const valorRestanteContrato = mesesRestantes * fee;
        const multa = valorRestanteContrato * 0.10;

        // Cálculo do aviso prévio
        let valorAvisoPrevio = 0;
        if (avisoPrevioDias === 30) {
            valorAvisoPrevio = fee;
        } else if (avisoPrevioDias === 60) {
            valorAvisoPrevio = fee * 2;
        }

        // Cálculo do total a ser pago
        const totalAPagar = valorProporcional + valorFeesEmAtraso + multa + valorAvisoPrevio;

        // Exibição do resultado detalhado
        resultadoDiv.innerHTML = `
            <div class="bg-gray-50 border border-gray-200 p-6 rounded-lg result-card">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Resultado do Cálculo</h2>
                <div class="space-y-3 text-gray-700">
                    <div class="flex justify-between"><span>Valor Proporcional (${diasTrabalhados} de ${diasNoMes} dias):</span> <span class="font-semibold">${formatarMoeda(valorProporcional)}</span></div>
                    <div class="flex justify-between"><span>Fees em Atraso (${feesEmAtraso} meses):</span> <span class="font-semibold">${formatarMoeda(valorFeesEmAtraso)}</span></div>
                    <div class="flex justify-between"><span>Multa Rescisória (10% de ${formatarMoeda(valorRestanteContrato)}):</span> <span class="font-semibold">${formatarMoeda(multa)}</span></div>
                    <div class="flex justify-between"><span>Aviso Prévio (${avisoPrevioDias} dias):</span> <span class="font-semibold">${formatarMoeda(valorAvisoPrevio)}</span></div>
                </div>
                <hr class="my-4">
                <div class="flex justify-between items-center text-xl font-bold text-red-600">
                    <span>TOTAL A PAGAR:</span>
                    <span>${formatarMoeda(totalAPagar)}</span>
                </div>
            </div>
        `;

        // Exibição da lista de vigências para conferência
        let vigenciasHtml = '<h3 class="text-xl font-bold text-gray-700 mt-8 mb-4">Linha do Tempo do Contrato</h3><div class="space-y-2">';
        vigencias.forEach((v, index) => {
            let statusClass = '';
            if (index < vigenciaAtualIndex) {
                statusClass = 'bg-green-100 text-green-800';
            } else if (index === vigenciaAtualIndex) {
                statusClass = 'bg-yellow-100 text-yellow-800 border-2 border-yellow-400';
            } else {
                statusClass = 'bg-gray-200 text-gray-600';
            }
            vigenciasHtml += `<div class="p-3 rounded-lg flex justify-between items-center text-sm ${statusClass}">
                                <span>Vigência ${index + 1}:</span>
                                <span class="font-mono">${formatarData(v.inicio)} - ${formatarData(v.fim)}</span>
                             </div>`;
        });
        vigenciasHtml += '</div>';
        vigenciasDiv.innerHTML = vigenciasHtml;
    }
</script>

</body>
</html>

